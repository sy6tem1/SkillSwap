{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="profile-container">

    <!-- Аватарка -->
    {% if profile.photo %}
        <img src="{{ profile.photo.url }}" class="profile-avatar">
    {% else %}
        <img src="{% static 'img/default-avatar.png' %}" class="profile-avatar">
    {% endif %}

    <!-- Имя пользователя -->
     <h2>{{ profile.name }}</h2>

    <!-- Telegram -->
    {% if profile.telegram %}
        <p>Telegram: <a href="https://t.me/{{ profile.telegram |cut:"@" }}" target="_blank">@{{ profile.telegram|cut:"@"  }}</a></p>
    {% else %}
        <p>Telegram не указан</p>
    {% endif %}

    <!-- Кнопка редактирования -->
    <div>
        <a href="{% url 'edit_profile' %}" class="edit-profile-btn">Редактировать профиль</a>
    </div>

</div>

<!-- Стили для центрирования аватарки и внешнего вида -->
<style>
.profile-container {
    text-align: center; /* центрируем всё внутри */
    margin-top: 30px;
}

.avatar-wrapper {
    display: flex;
    justify-content: center; /* горизонтальное центрирование */
    margin-bottom: 15px;
}

.profile-avatar {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #ccc;
}

.edit-profile-btn {
    display: inline-block;
    margin-top: 15px;
    padding: 8px 15px;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 5px;
}

.edit-profile-btn:hover {
    background-color: #0056b3;
}
</style>



<div class="app-header">
    <h2 class="focus-phrase">Мой профиль</h2>
</div>

<div class="profile-edit-container">

    <form method="post" enctype="multipart/form-data" class="profile-edit-form">
        {% csrf_token %}

        <input type="hidden" name="skills" id="skillsField">

        <!-- Аватар -->
        <div class="profile-avatar-edit">
            <label class="avatar-label">
                {% if profile.photo %}
                    <img src="{{ profile.photo.url }}" class="avatar-preview">
                {% else %}
                    <img src="{% static 'assets/images/123.jpg' %}" class="avatar-preview">
                {% endif %}
                <span class="avatar-change">Изменить фото</span>
                <input type="file" name="photo" hidden>
            </label>
        </div>

        <!-- Имя -->
        <input
            type="text"
            name="name"
            class="reg-field-input"
            placeholder="Имя"
            value="{{ profile.name }}"
        >

        <!-- Описание -->
        <textarea
            name="description"
            class="reg-field-input textarea"
            placeholder="О себе"
        >{{ profile.description }}</textarea>

        <!-- Telegram -->
        <input
            type="text"
            name="telegram"
            class="reg-field-input"
            placeholder="@telegram"
            value="{{ profile.telegram }}"
        >

        <!-- Навыки -->
        <div class="skills-edit-block">

            <p class="section-title">Навыки</p>

            <div class="skills-step">

                <input
                    type="text"
                    id="skillInput"
                    placeholder="Добавить навык"
                    class="reg-field-input"
                    autocomplete="off"
                >

                <ul id="skillsDropdown" class="skills-dropdown"></ul>

                <div id="selectedSkills" class="selected-skills"></div>

            </div>

        </div>

        <!-- Кнопки -->
        <div class="profile-actions">


            <a href="{% url 'profile_detail' profile.slug %}" class="btn-secondary">
                Посмотреть профиль
            </a>


            <button type="submit" class="btn-primary">
                Сохранить
            </button>

            
        </div>

    </form>

</div>


<script>
const form = document.querySelector(".profile-edit-form");

form.addEventListener("submit", () => {
    document.getElementById("skillsField").value =
        JSON.stringify(selectedSkills);
});
</script>




<script>
    const initialSkills = [
        {% for skill in profile.skills.all %}
            { id: {{ skill.id }}, name: "{{ skill.name }}" },
        {% endfor %}
    ];
</script>
<script src="{% static 'assets/js/skills_input.js' %}"></script>


{% endblock %}

