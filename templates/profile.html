{% extends "base.html" %}
{% load static %}

{% block content %}


<div class="app-header">
    <h2 class="focus-phrase">Мой профиль</h2>
</div>

<div class="profile-edit-container">

    <form method="POST" enctype="multipart/form-data" class="profile-edit-form">
        {% csrf_token %}

        <input type="hidden" name="skills" id="skillsField">

        <!-- Аватар -->
        <div class="profile-avatar-edit">
            <label class="avatar-label">
                {% if profile.photo %}
                    <img src="{{ profile.photo.url }}" class="avatar-preview">  
                {% else %}
                    <img src="{% static 'assets/images/123.jpg' %}" class="avatar-preview">
                {% endif %}
                <span class="avatar-change">Изменить фото</span>
                {% comment %} <input type="file" name="photo" accept="image/*" id="id_photo"> {% endcomment %}
                
                {{ form.photo }}
            </label>
        </div>


        <!-- Имя -->
        {{ form.name }}


        <!-- Описание -->
        {{ form.description }}

        <div id="wordCounterFixed">
            <span id="wordCount">0</span> / 20 слов
        </div>

        <!-- Telegram -->
        {{ form.telegram }}


        <!-- Навыки -->
        <div class="skills-edit-block">

            <p class="section-title">Навыки</p>

            <div class="skills-step">
                
                <input
                    type="text"
                    id="skillInput"
                    placeholder="Добавить навык"
                    class="reg-field-input"
                    autocomplete="off"
                >
                
                <ul id="skillsDropdown" class="skills-dropdown"></ul>

                <div id="selectedSkills" class="selected-skills" style="margin-top: 10px;">
                    
                </div>


            </div>

        </div>

        <!-- Кнопки -->
        <div class="profile-actions">


            <a href="{% url 'profile_detail' profile.slug %}" class="btn-secondary">
                Посмотреть профиль
            </a>


            <button type="submit" class="btn-primary">
                Сохранить
            </button>

            
        </div>

    

    </form>

</div>







{% comment %} Редактирование навыков {% endcomment %}




<script>
    window.INITIAL_SKILLS = [
        {% for skill in profile.skills.all %}
            {
                id: {{ skill.id }},
                name: "{{ skill.name }}"
            },
        {% endfor %}
    ];
</script>


<script src="{% static 'js/skills_input.js' %}"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const textarea = document.querySelector(
        'textarea[name="description"]'
    );
    if (!textarea) return;

    const minHeight = 40;

    const autoResize = () => {
        textarea.style.height = minHeight + "px";

        if (textarea.scrollHeight > minHeight) {
            textarea.style.height = textarea.scrollHeight + "px";
        }
    };

    textarea.addEventListener("input", autoResize);

    // стартовое состояние
    autoResize();
});
</script>







{% comment %} Анимации {% endcomment %}



<script>
const photoInput = document.querySelector('input[name="photo"]');
const avatarImg = document.querySelector('.avatar-preview');

photoInput.addEventListener('change', () => {
    const file = photoInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
        avatarImg.src = e.target.result;
    };
    reader.readAsDataURL(file);
});
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
    const textarea = document.querySelector('textarea[name="description"]');
    const wordCountSpan = document.getElementById('wordCount');
    const maxWords = 20;

    if (!textarea || !wordCountSpan) return;

    const updateWordCount = () => {
        const text = textarea.value.trim();
        const words = text === "" ? 0 : text.split(/\s+/).length;
        wordCountSpan.textContent = words;

        // можно добавить ограничение
        if (words > maxWords) {
            wordCountSpan.style.color = "red";
        } else {
            wordCountSpan.style.color = "black";
        }
    };

    textarea.addEventListener("input", updateWordCount);

    // сразу обновляем счетчик при загрузке
    updateWordCount();
});
</script>



{% endblock %}

